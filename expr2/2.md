# 多媒体技术实验二：基于傅里叶描述子的手写数字识别

## 一、实验目的

1.  **理解形状特征描述方法**：掌握傅里叶描述子（Fourier Descriptors, FD）的基本概念，理解其如何将二维形状轮廓转换为一维频域特征。
2.  **掌握图像预处理与轮廓提取**：学习使用图像处理技术（如二值化、形态学操作、轮廓查找）从灰度图像中提取目标物体的边界。
3.  **实现手写数字识别系统**：利用 Python 和 Scikit-learn 库，构建一个包含特征提取、模型训练和分类预测的完整机器学习流水线。
4.  **评估特征有效性**：通过分类准确率和可视化结果，分析傅里叶描述子在表征手写数字形状方面的能力。

## 二、实验原理

### 1. 图像轮廓提取
在进行形状分析前，首先需要从图像中提取出目标的边界轮廓。
-   **二值化**：使用 Otsu 大津法自动确定阈值，将灰度图像转换为黑白二值图像，分离前景（数字）和背景。
-   **形态学操作**：使用闭运算（Closing）填充数字笔画内部的细小空洞，连接断裂的笔画，确保轮廓的连续性。
-   **轮廓跟踪**：使用算法（如 Marching Squares）寻找二值图像中物体的边缘坐标序列。

### 2. 傅里叶描述子 (Fourier Descriptors)
傅里叶描述子是一种基于物体轮廓形状的特征描述方法。
-   **复数表示**：假设轮廓由 $N$ 个点组成，坐标为 $(x_k, y_k)$。将其表示为复数序列 $z_k = x_k + j y_k, \quad k=0, 1, \dots, N-1$。
-   **离散傅里叶变换 (DFT)**：对复数序列 $z_k$ 进行 DFT，得到频域系数 $Z_u$。
    $$ Z_u = \sum_{k=0}^{N-1} z_k e^{-j 2\pi u k / N} $$
-   **特征选择**：
    -   低频系数（$u$ 较小）反映了轮廓的总体形状（如圆形、椭圆形）。
    -   高频系数（$u$ 较大）反映了轮廓的细节和噪声。
    -   通常选取前 $M$ 个低频系数作为特征向量。
-   **不变性处理**：
    -   **平移不变性**：将直流分量 $Z_0$ 置为 0（或仅使用 $u \ge 1$ 的系数），消除物体在图像中位置的影响。
    -   **缩放不变性**：将所有系数除以第一个非零系数的模（通常是 $Z_1$）或整个特征向量的范数，消除物体大小的影响。
    -   **旋转不变性**：取系数的模 $|Z_u|$，消除物体旋转角度的影响。

### 3. 分类器
本实验使用 **逻辑回归 (Logistic Regression)** 作为分类器。虽然它是一个线性模型，但对于经过良好特征提取的数据（如傅里叶描述子），往往能取得不错的分类效果。

## 三、实验步骤与内容

### 1. 数据集加载与观察
使用 `sklearn.datasets.load_digits` 加载手写数字数据集。该数据集包含 1797 个样本，原始大小为 8x8 像素。

```python
digits = load_digits()
images = digits.images  # (1797, 8, 8)
labels = digits.target
```

### 2. 图像预处理与轮廓重采样
由于原始 8x8 图像分辨率过低，难以提取平滑轮廓，实验中先将图像上采样至 64x64 像素。
定义 `resample_contour` 函数，将提取出的变长轮廓坐标重采样为固定的 $N=256$ 个点，以便进行统一长度的 FFT 计算。

### 3. 傅里叶描述子提取算法实现
编写 `extract_fourier_descriptors` 函数，核心流程如下：
1.  **Resize**：将图像放大至 64x64。
2.  **二值化**：使用 `threshold_otsu` 获取阈值并二值化。
3.  **闭运算**：使用 `binary_closing` 优化二值掩膜。
4.  **提取轮廓**：使用 `find_contours` 找到最长轮廓。
5.  **重采样**：将轮廓重采样为 256 点。
6.  **FFT**：构造复信号 $x+jy$ 并进行 FFT。
7.  **特征构建**：截取前 32 个低频系数（跳过直流分量），拼接实部和虚部，并进行 L2 归一化以实现缩放不变性。

```python
# 核心代码片段
complex_signal = contour[:, 1] + 1j * contour[:, 0]
fft_coeffs = np.fft.fft(complex_signal)
fft_coeffs[0] = 0  # 去除直流分量（平移不变性）
descriptors = fft_coeffs[1 : num_descriptors + 1]
feature = np.concatenate([descriptors.real, descriptors.imag])
norm = np.linalg.norm(feature) + 1e-8
return feature / norm  # 归一化
```

### 4. 模型训练与评估
-   批量提取所有样本的特征，得到特征矩阵。
-   将数据划分为训练集和测试集（75% : 25%）。
-   使用 `StandardScaler` 对特征进行标准化，并训练 `LogisticRegression` 分类器。
-   计算测试集准确率。

## 四、实验结果与现象

### 1. 单个样本特征分析
选取一个样本（如数字 0）进行可视化。
-   **左图**：展示了经过预处理后的数字图像。
-   **右图**：展示了傅里叶描述子的幅度谱。可以看到能量主要集中在低频部分（索引较小的位置），这验证了低频分量包含了形状的主要信息。

### 2. 分类准确率
在测试集上进行评估，模型取得了较好的识别效果。
-   **测试集准确率**：约为 **0.80 - 0.85** (具体数值取决于数据划分的随机种子)。
-   考虑到原始图像仅为 8x8 分辨率，且我们仅使用了轮廓形状特征（丢弃了灰度纹理信息），这一准确率证明了傅里叶描述子在表征数字几何结构方面的有效性。

### 3. 识别结果示例
展示了测试集中 0-9 每个数字的典型识别结果。
-   可视化结果显示，对于书写规范、轮廓清晰的数字，模型均能做出正确预测。
-   **潜在的错误分析**：对于某些书写潦草、笔画断裂或粘连严重的数字（如 '3' 和 '8'，'1' 和 '7'），提取的轮廓可能发生畸变，导致频域特征相似，从而产生误判。

## 五、总结和展望

### 1. 实验总结
通过本次实验，我们成功实现了一个基于形状特征的手写数字识别系统。
-   **有效性**：傅里叶描述子能够有效地将二维图像降维为紧凑的一维特征向量，同时保留了形状的拓扑结构信息。
-   **鲁棒性**：通过归一化处理，该特征对图像的平移和缩放具有不变性，适合处理不同大小和位置的手写输入。
-   **局限性**：该方法高度依赖于轮廓提取的质量。如果图像噪声大、对比度低导致轮廓断裂，或者数字本身拓扑结构复杂（如 '8' 分为两个圈），简单的单轮廓描述子可能无法完整表达特征。

### 2. 展望与改进
-   **多轮廓处理**：目前的算法仅选取了最长的一条轮廓。对于包含孔洞的数字（如 0, 6, 8, 9），内部轮廓也包含重要信息。未来可以改进算法，综合内外轮廓的傅里叶描述子。
-   **分类器升级**：逻辑回归是线性分类器，能力有限。可以尝试使用支持向量机 (SVM) 或随机森林等非线性分类器来进一步提升准确率。
-   **结合其他特征**：可以将傅里叶描述子（形状特征）与 HOG（方向梯度直方图）或原始像素特征结合，构建更强大的混合特征向量。
