# 实验二 基于傅里叶描述子的手写数字识别

## 一、实验目的

- 理解傅里叶描述子（Fourier Descriptors）在形状表示与轮廓特征提取中的基本思想。
- 掌握从手写数字图像中提取轮廓、构造复数信号并计算傅里叶谱的完整流程。
- 学习如何将傅里叶描述子作为特征输入到传统机器学习分类器（如逻辑回归）中，实现多类别数字识别。
- 通过实验观察频谱特征与分类效果之间的关系，体会特征设计、归一化与分类模型选择对识别性能的影响。

## 二、实验原理

### 1. 轮廓表示与傅里叶描述子

对于二值图像中的连通区域，可以提取目标的外轮廓，将其表示为按顺序排列的一系列边界点：

$$C = \{(x_k, y_k) \mid k = 0, 1, \dots, N-1\}.$$

为了便于频域分析，我们通常将轮廓坐标表示为复数序列：

$$z_k = x_k + j y_k, \quad k = 0, 1, \dots, N-1.$$

对该复数序列进行离散傅里叶变换（DFT），得到频域系数：

$$Z_n = \sum_{k=0}^{N-1} z_k e^{-j 2\pi nk / N}, \quad n = 0, 1, \dots, N-1.$$

这些傅里叶系数 $Z_n$ 即为傅里叶描述子，它们从频域角度刻画了轮廓形状的全局与局部特征。低频系数描述轮廓的整体形状，高频系数刻画细节与噪声。

### 2. 归一化与不变性

在实际应用中，我们希望特征对平移、尺度和起始点选择等变化具有一定的不变性。因此，常见的归一化处理包括：

- **平移不变**：通过减去轮廓重心，或直接将直流分量 $Z_0$ 置零；
- **尺度不变**：对所有傅里叶系数按某种范数进行归一化，例如除以特征向量的 L2 范数；
- **起始点不敏感**：轮廓起点的改变对应频谱的整体相位变化，可通过只使用幅度信息或适当的系数选取来减弱影响。

在本实验的实现中，首先将 $Z_0$ 置为 0，以去除平移影响；然后取前若干个非零频率的实部与虚部拼接成特征向量，并通过 L2 归一化实现尺度标准化。

### 3. 手写数字识别流程

综合 Notebook 代码，本实验的整体识别流程如下：

1. **数据准备**：从 `sklearn.datasets` 加载 `digits` 手写数字数据集，将 8×8 灰度图作为基础样本；
2. **图像预处理与轮廓提取**：
	- 将原始图像缩放到固定大小（如 64×64），并归一化为浮点图；
	- 使用大津法（Otsu）阈值分割得到二值图像；
	- 通过形态学闭运算填补轮廓细小空洞，提升边界连通性；
	- 使用 `find_contours` 提取目标轮廓，并选取其中最长的轮廓作为数字主体轮廓；
3. **傅里叶描述子提取**：
	- 对轮廓按照弧长进行重采样，使其包含固定数量的等距点，保证不同图像间具有可比性；
	- 将采样点坐标构造成复数序列并进行 FFT；
	- 舍弃直流分量，选取前 `NUM_DESCRIPTORS` 个频率系数的实部与虚部拼接成特征向量；
	- 对特征向量做 L2 归一化，得到最终的傅里叶描述子特征。
4. **分类与评估**：
	- 使用 `train_test_split` 将样本划分为训练集和测试集，保证各类数字分布均衡；
	- 构建包含 `StandardScaler` 与 `LogisticRegression` 的管线，对特征进行标准化后训练多项逻辑回归分类器；
	- 在测试集上评估分类准确率，并展示部分典型识别结果。

## 三、实验步骤与内容

### 1. 环境配置与库导入

在 Notebook 的开头，首先导入所需的第三方库：

- `numpy`：用于数值计算与向量/矩阵操作；
- `matplotlib`：用于可视化图像与频谱；
- `sklearn`：提供 `load_digits` 数据集、数据划分工具以及逻辑回归模型；
- `skimage`：用于图像缩放、阈值分割、形态学处理与轮廓提取；
- 以及 `pathlib`、`PIL` 等用于路径和图片读写的工具。

同时配置 `matplotlib` 支持中文显示，以便在图像标题中使用中文说明。

### 2. 辅助函数实现

Notebook 中实现了两个关键辅助函数：

1. **`resample_contour`**：
	- 输入一条轮廓点序列和目标点数 `num_points`；
	- 计算相邻点之间的欧氏距离，得到曲线长度累计数组；
	- 通过一维插值，在等弧长位置重新采样出固定数量的点；
	- 若轮廓点数过少或总长度为 0，则重复首点以保证输出维度稳定。

2. **`extract_fourier_descriptors`**：
	- 接收单张灰度图像，先缩放到统一大小并进行 Otsu 阈值分割与形态学闭运算；
	- 使用 `find_contours` 提取二值图像的轮廓，若未检测到轮廓则返回零特征；
	- 选取最长轮廓并调用 `resample_contour` 进行重采样；
	- 将轮廓坐标转换为复数序列并计算 FFT；
	- 置零直流分量，截取前 `num_descriptors` 个频率系数的实部与虚部合并；
	- 对最终特征向量做 L2 归一化，返回定长特征。

### 3. 加载数据集与单样本分析

1. 使用 `load_digits()` 加载手写数字数据集，得到图像数组 `images` 和标签 `labels`；
2. 选取一个样本（例如索引为 0 的数字），调用 `extract_fourier_descriptors` 提取其描述子；
3. 计算描述子的幅度谱并绘制：左图展示原始数字图像，右图展示傅里叶描述子幅度随频率索引变化的曲线，以直观观察低频与高频成分的分布。

### 4. 批量提取特征

对整个 `digits` 数据集中的所有图像逐一调用 `extract_fourier_descriptors`，将结果堆叠成特征矩阵 `features`，其形状为：

- 样本数 × 特征维度（其中特征维度为 `2 * NUM_DESCRIPTORS`）。

通过打印形状确认特征维度设置是否合理、提取过程是否成功。

### 5. 训练分类器并评估

1. 使用 `train_test_split` 按比例（如 3:1）划分训练集和测试集，并使用 `stratify` 参数保证各类别样本数大致均衡；
2. 构造包含 `StandardScaler` 和 `LogisticRegression` 的 `Pipeline`，对训练集特征进行标准化并训练多项逻辑回归模型；
3. 在测试集上调用 `score` 方法计算分类准确率，并打印测试集整体识别率（Notebook 中输出类似 `测试集准确率: 0.9xxx` 的结果）；
4. 进一步在测试集中为每个数字类别选取一个代表样本，显示其原始图像，并在标题中标注“真实标签 | 预测标签”，用于直观检查分类效果和错误样本。

### 6. 外部图片识别接口

为了便于后续扩展，Notebook 中还定义了 `predict_digit_from_path` 函数：

- 从给定的图片路径读取手写数字图像，并转换为灰度；
- 调用与数据集中相同的 `extract_fourier_descriptors` 过程提取描述子；
- 使用训练好的 `pipeline` 模型预测该图片对应的数字类别；
- 返回预测结果，实现对外部手写数字图片的快速识别接口。

## 四、实验结果与现象

1. **傅里叶描述子幅度谱**：
	- 对单个样本数字的实验显示，傅里叶描述子的幅度谱在低频部分能量集中，而高频部分幅度较小；
	- 这与“轮廓整体形状由低频成分主导、细节与噪声由高频成分描述”的理论相吻合，也说明在特征压缩时可以仅保留少量低频系数。

2. **整体识别率**：
	- 在当前参数设置下（例如 `NUM_DESCRIPTORS = 32`，逻辑回归最大迭代次数 1000），测试集准确率达到较高水平（约 90% 以上）；
	- 说明利用傅里叶描述子作为轮廓特征，加上简单的线性分类器，就可以在标准手写数字数据集上获得不错的识别效果。

3. **典型识别样例**：
	- Notebook 中展示了测试集中 0–9 各类数字的典型识别结果，大部分样本可以被正确分类；
	- 对于易混淆的数字（如 3/5、4/9 等），在轮廓形状较为相似或书写风格特别时，偶尔会出现误判；
	- 这些现象反映出单一轮廓特征在某些细节区分上存在局限，可能需要结合笔画内部纹理或多尺度特征来进一步提升性能。

4. **参数与预处理的影响**：
	- 轮廓重采样点数、保留的描述子数量以及阈值分割和形态学操作的设置，都会影响轮廓质量与特征稳定性；
	- 适当增加描述子数量可以提升对复杂形状的表征能力，但过多会引入噪声并增加模型复杂度；
	- 标准化（`StandardScaler`）对逻辑回归训练的收敛速度和最终识别率也有明显帮助。

## 五、总结和展望

通过本实验，我对“基于轮廓的形状特征”和“傅里叶描述子”的概念有了更加直观的认识。从实现过程和结果上，可以得到如下几点体会：

1. **傅里叶描述子适合表示整体形状**：
	- 通过将轮廓点映射为复数序列并进行 FFT，可以用有限个低频系数有效地描述手写数字的大致形状；
	- 合理的归一化处理（去除直流分量、归一化幅度）使得特征对平移和尺度变化具有一定鲁棒性。

2. **特征 + 经典机器学习仍然有效**：
	- 即便不使用深度学习，仅依靠设计良好的特征（傅里叶描述子）和传统分类器（逻辑回归），在标准数据集上也能取得较高的识别率；
	- 这也说明在样本规模较小、计算资源有限的场景下，经典特征工程方法依然具有实用价值。

3. **局限性与改进方向**：
	- 仅使用轮廓特征难以区分内部结构差别较大的数字，且对书写断笔、噪声、轮廓破损较为敏感；
	- 可以考虑结合区域特征（如灰度纹理、方向梯度直方图）、多尺度轮廓描述子或更为复杂的分类器（如 SVM、随机森林）以进一步提升性能；
	- 在更大规模、更复杂的数据集上，可以将傅里叶描述子作为先验或辅助特征，与卷积神经网络等深度模型结合，实现精度与效率的平衡。

总体来看，本实验帮助我系统梳理了从图像预处理、轮廓提取、特征构造到模型训练和评估的完整流程，加深了对“频域特征”和“形状识别”之间联系的理解，为后续学习形状分析与图像理解的高级方法打下了基础。
